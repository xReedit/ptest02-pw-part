<div class="modal-overlay">
    <div class="modal-container">
        <!-- Checking State -->
        <div class="checking-container" *ngIf="isChecking">
            <div class="loader"></div>
            <h3>Verificando permisos...</h3>
            <p>Por favor espera un momento.</p>
        </div>

        <!-- Main content (only when not checking) -->
        <div *ngIf="!isChecking">
            <div class="modal-header">
                <div class="icon-container">
                    <i class="permission-icon">üöÄ</i>
                </div>
                <h2>Configuraci√≥n Necesaria</h2>
                <p>Para brindarte la mejor experiencia y asegurar que recibas tus pedidos, necesitamos activar algunas
                    funciones.</p>
            </div>

            <div class="permissions-list">
                <!-- GPS Permission -->
                <div class="permission-item" [class.granted]="gpsGranted && !gpsOff" [class.error]="gpsOff">
                    <div class="item-icon gps">üìç</div>
                    <div class="item-content">
                        <h3>Ubicaci√≥n (GPS)</h3>
                        <p *ngIf="!gpsGranted && !gpsOff">Necesaria para el seguimiento de entregas y c√°lculo de distancias.</p>
                        <div *ngIf="gpsOff" class="error-instructions">
                            <p class="error-text"><strong>‚ö†Ô∏è GPS Desactivado</strong></p>
                            <ol class="steps-list">
                                <li>Desliza desde arriba para abrir el panel de ajustes r√°pidos</li>
                                <li>Toca el √≠cono de <strong>Ubicaci√≥n</strong> para activarlo</li>
                                <li>Vuelve a esta pantalla y presiona "Verificar de Nuevo"</li>
                            </ol>
                        </div>
                    </div>
                    <div class="status-badge" *ngIf="gpsGranted && !gpsOff">‚úì</div>
                    <div class="status-badge error" *ngIf="gpsOff">‚úï</div>
                </div>

                <!-- Notifications Permission -->
                <div class="permission-item" [class.granted]="notificationsGranted">
                    <div class="item-icon notifications">üîî</div>
                    <div class="item-content">
                        <h3>Notificaciones</h3>
                        <p>Crucial para recibir avisos de nuevos pedidos y mensajes.</p>
                    </div>
                    <div class="status-badge" *ngIf="notificationsGranted">‚úì</div>
                </div>
            </div>

            <div class="modal-footer">
                <p class="instruction-text" *ngIf="!allGranted && !gpsOff">
                    Por favor, habilita los permisos faltantes para continuar.
                </p>
                <button class="btn-primary" (click)="requestAll()" *ngIf="!allGranted && !gpsOff">
                    Habilitar Ahora
                </button>
                <button class="btn-primary" (click)="checkCurrentStatus()" *ngIf="gpsOff">
                    Verificar de Nuevo
                </button>
                <div class="success-message" *ngIf="allGranted">
                    <div class="success-icon">‚ú®</div>
                    <p>¬°Todo listo! Iniciando aplicaci√≥n...</p>
                </div>
            </div>
        </div>
    </div>
</div>